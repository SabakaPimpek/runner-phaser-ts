var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-y5S3hZEA.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i=s();class a extends i.Scene{constructor(){super("Boot")}preload(){this.load.setPath("assets/images/ui/load_bar"),this.load.image("load-bar-content","2.png"),this.load.image("load-bar-bg","bg.png"),this.load.image("load-bar-text","text.png")}create(){this.scene.start("Preloader")}}class r extends i.Scene{constructor(){super("GameOver"),e(this,"camera"),e(this,"background"),e(this,"gameover_text")}init(t){console.log(t.gameData.score)}create(){this.sound.stopAll(),this.camera=this.cameras.main,this.camera.setBackgroundColor(16711680),this.background=this.add.image(512,384,"background"),this.background.setAlpha(.5),this.gameover_text=this.add.text(512,384,"Game Over",{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}),this.gameover_text.setOrigin(.5),this.input.once("pointerdown",(()=>{this.scene.start("MainMenu")}))}}class h{constructor(){e(this,"states",new Map),e(this,"currentState")}addState(t,e){this.states.set(t,{name:t,...e})}setState(t){var e,s,i,a,r;if((null==(e=this.currentState)?void 0:e.name)===t)return;null==(i=null==(s=this.currentState)?void 0:s.onExit)||i.call(s);const h=this.states.get(t);h?(this.currentState=h,null==(r=(a=this.currentState).onEnter)||r.call(a)):console.warn(`State ${t} not found`)}update(t){var e,s;null==(s=null==(e=this.currentState)?void 0:e.onUpdate)||s.call(e,t)}getCurrentState(){var t;return null==(t=this.currentState)?void 0:t.name}}class n extends Phaser.Physics.Arcade.Sprite{constructor(t,s,i){var a,r,n;super(t,s,i,"character-run"),e(this,"scene"),e(this,"stateMachine",new h),e(this,"isInvincible",!1),e(this,"pointerJustDown",!1),this.scene=t,t.add.existing(this),t.physics.add.existing(this),this.setCollideWorldBounds(!0),this.setSize(.75*this.width,this.height),(null==(a=this.body)?void 0:a.halfWidth)&&this.setSize(null==(r=this.body)?void 0:r.halfWidth,null==(n=this.body)?void 0:n.height),this.createStates(),this.stateMachine.setState("running"),this.setDepth(2),this.setMaxVelocity(300,900),t.input.on("pointerdown",(()=>{this.pointerJustDown=!0}))}createStates(){this.stateMachine.addState("running",{onEnter:()=>this.play("character-run",!0),onUpdate:()=>{var t;this.setVelocityX(300),(null==(t=this.body)?void 0:t.blocked.down)||this.stateMachine.setState("jumping"),this.pointerJustDown&&(this.jump(),this.stateMachine.setState("jumping"))}}),this.stateMachine.addState("jumping",{onEnter:()=>this.play("character-jump"),onUpdate:()=>{this.setVelocityX(300),this.pointerJustDown&&(this.jump(),this.stateMachine.setState("doubleJumping")),this.checkIfOnGround()}}),this.stateMachine.addState("doubleJumping",{onEnter:()=>this.play("character-jump"),onUpdate:()=>{this.setVelocityX(300),this.checkIfOnGround()}}),this.stateMachine.addState("dead",{onEnter:()=>{this.setActive(!1).setVisible(!1).setMaxVelocity(0,0)},onUpdate:()=>{this.isInvincible=!0}})}update(t){this.stateMachine.update(t),this.pointerJustDown=!1}jump(){this.setVelocityY(-700),this.scene.sound.play("player-jump")}checkIfOnGround(){var t;(null==(t=this.body)?void 0:t.blocked.down)&&this.stateMachine.setState("running")}hurt(){return!this.isInvincible&&(this.scene.sound.play("player-hurt"),this.isInvincible=!0,this.scene.cameras.main.shake(100,.01),this.scene.tweens.add({targets:this,alpha:0,duration:100,yoyo:!0,repeat:4,onComplete:()=>{this.alpha=1}}),this.scene.time.delayedCall(1e3,(()=>{this.isInvincible=!1,this.alpha=1})),this.stateMachine.setState("jumping"),!0)}death(){this.stateMachine.setState("dead")}}class o extends Phaser.Physics.Arcade.Sprite{constructor(t,s,i){super(t,s,i,"spritesheet",78),e(this,"active",!0),t.add.existing(this),t.physics.add.existing(this),this.setImmovable(!0),this.setScale(3.5);const a=t.physics.world.gravity;this.setGravity(-a.x,-a.y)}collect(){return!!this.active&&(this.scene.sound.play("coin-pickup",{volume:.3}),this.setActive(!1),this.setVisible(!1),!0)}setActive(t){return this.active=t,super.setActive(t),this.setVisible(t),this}}class c extends Phaser.GameObjects.Rectangle{constructor(t,s,i,a=16,r=16){super(t,s,i,a,r,16711680,0),e(this,"scene"),this.scene=t,this.scene.add.existing(this),this.scene.physics.add.existing(this),this.setOrigin(0);const h=this.body;h.setAllowGravity(!1),h.setImmovable(!0)}}class l{constructor(t,s,i,a,r){e(this,"scene"),e(this,"tilemap"),e(this,"x"),e(this,"y"),e(this,"scale"),e(this,"topLayer"),e(this,"botLayer"),e(this,"objectGroup"),e(this,"active",!1),this.scene=t,this.x=i,this.y=a,this.scale=r,this.createTilemap(s,i,a,r),this.objectGroup=this.scene.physics.add.group({allowGravity:!1}),this.createObjects(),this.botLayer}createTilemap(t,e,s,i){var a;this.tilemap=this.scene.make.tilemap({key:t});const r=this.tilemap.addTilesetImage("spritesheet","spritesheet");r&&(this.botLayer=this.tilemap.createLayer("Bot",r,e,s),this.botLayer&&(null==(a=this.botLayer)||a.setScale(i),this.setColliders(this.botLayer)),this.topLayer=this.tilemap.createLayer("Top",r,e,s),this.topLayer&&(this.topLayer.setScale(i),this.setColliders(this.topLayer)))}setColliders(t){t.forEachTile((t=>{!0===t.properties.collide&&t.setCollision(!1,!1,!0,!1)}))}createObjects(){const t=this.tilemap.getObjectLayer("Objects");t&&t.objects.forEach((t=>{const{x:e=0,y:s=0,name:i,width:a=0,height:r=0}=t,h=e*this.scale+this.getX(),n=s*this.scale+this.getY();switch(i){case"coin":const t=new o(this.scene,h,n);this.objectGroup.add(t);break;case"spikes":const e=new c(this.scene,h,n,a*this.scale,r*this.scale);this.objectGroup.add(e)}}))}getWidth(){return this.tilemap.widthInPixels*this.scale}getHeight(){return this.tilemap.heightInPixels*this.scale}getX(){return this.x}getY(){return this.y}getEndX(){return this.getWidth()+this.x}getEndY(){return this.getHeight()+this.y}setX(t){const e=t-this.x;this.x=t,this.botLayer&&this.botLayer.setX(t),this.topLayer&&this.topLayer.setX(t),this.objectGroup.getChildren().forEach((t=>{t.x+=e}))}getActive(){return this.active}setActive(t){var e,s;this.active=t,null==(e=this.topLayer)||e.setActive(t).setVisible(t),null==(s=this.botLayer)||s.setActive(t).setVisible(t),this.objectGroup.getChildren().forEach((e=>{const s=e;s.setActive&&s.setActive(t),s.setVisible&&s.setVisible(t)}))}}const d=["tile1","tile2","tile3"];class u{constructor(t,s,i,a){e(this,"scene"),e(this,"x"),e(this,"y"),e(this,"scale"),e(this,"tilemaps"),e(this,"activeTilemaps",[]),this.scene=t,this.x=s,this.y=i,this.scale=a,this.tilemaps=this.createTilemapsArray(),this.initActiveTilemaps()}createTilemapsArray(){const t=[];for(let e=0;e<d.length;e++){const s=d[e],i=new l(this.scene,s,-9e3,this.y,this.scale);i.setActive(!1),t.push(i)}return t}initActiveTilemaps(){const t=this.tilemaps,e=Phaser.Utils.Array.GetRandom(t),s=t.filter((t=>t!==e)),i=Phaser.Utils.Array.GetRandom(s);e.setActive(!0),i.setActive(!0),e.setX(this.x),i.setX(e.getEndX()),this.activeTilemaps.push(e,i)}update(){const t=this.scene.cameras.main.scrollX;this.activeTilemaps[0].getEndX()<t&&(this.removeFirstTilemap(),this.AddNewTilemapToEnd())}removeFirstTilemap(){const t=this.activeTilemaps.shift();t&&t.setActive(!1)}AddNewTilemapToEnd(){const t=this.activeTilemaps,e=this.tilemaps.filter((e=>!t.includes(e)));if(0===e.length)return;const s=Phaser.Utils.Array.GetRandom(e),i=t[t.length-1];s.setX(i.getEndX()),s.setActive(!0),this.activeTilemaps.push(s)}getAllObjects(){const t=[];for(const e of this.tilemaps){const s=e.objectGroup.getChildren();t.push(...s)}return t}}class p{constructor(t,s,i,a,r){e(this,"body"),this.body=t.add.sprite(s,i,a).setInteractive({useHandCursor:!0}).setDepth(50),this.body.on("pointerdown",(()=>{r()}))}setVisible(t){this.body.setVisible(t),this.body.setActive(t)}}class m{constructor(t,s){e(this,"bg"),e(this,"header"),e(this,"table"),e(this,"btnMenu"),e(this,"btnRestart"),e(this,"text"),e(this,"group");const{width:i,height:a}=t.sys.game.canvas;this.bg=t.add.image(i/2,a/2,"gameOver-bg").setScrollFactor(0).setDepth(50).setScale(s),this.table=t.add.image(i/2,a/2-.05*this.bg.height,"gameOver-table").setScrollFactor(0).setDepth(50).setScale(.5),this.header=t.add.image(i/2,(a-this.bg.height/2)*s,"gameOver-header").setScrollFactor(0).setDepth(50).setScale(s),this.btnMenu=new p(t,i/2+this.bg.width/4*s,a/2+this.bg.height/4*s+30,"btn-menu",(()=>{t.scene.start("MainMenu")})),this.btnMenu.body.setScale(.45).setScrollFactor(0),this.btnRestart=new p(t,i/2-this.bg.width/4*s,a/2+this.bg.height/4*s+30,"btn-restart",(()=>{t.scene.restart()})),this.btnRestart.body.setScale(.45).setScrollFactor(0),this.text=t.add.text(i/2,a/2,"Wynik: 0",{fontSize:60,color:"black",fontStyle:"bold"}).setDepth(50).setScrollFactor(0).setOrigin(.5,1),this.group=t.add.group([this.bg,this.table,this.header,this.btnMenu.body,this.btnRestart.body,this.text]),this.group.setActive(!1).setVisible(!1)}turnOn(t){this.text.setText("Wynik: "+t),this.group.setActive(!0).setVisible(!0)}}const g="spritesheet";class y{constructor(t,s=3){e(this,"scene"),e(this,"maxLives"),e(this,"currentLives"),e(this,"group",[]),this.scene=t,this.maxLives=s,this.currentLives=s,this.create()}create(){for(let t=0;t<this.maxLives;t++){const e=this.scene.add.sprite(this.scene.sys.canvas.width-40-70*t,40,g,139);e.setScrollFactor(0),e.setScale(3),e.setDepth(100),this.group.push(e)}this.group.sort(((t,e)=>t.x-e.x))}updateTexture(){for(let t=0;t<this.group.length;t++)t<this.currentLives?this.group[t].setTexture(g,139):this.group[t].setTexture(g,141)}addLife(){this.currentLives>=this.maxLives||(this.currentLives++,this.updateTexture())}removeLife(){this.currentLives>0&&(this.currentLives--,this.updateTexture())}setHearts(t){this.currentLives=t,this.updateTexture()}}class b{constructor(t,s,i,a,r){e(this,"scene"),e(this,"object"),this.scene=t,this.object=this.scene.add.text(s,i,a,r),this.object.setScrollFactor(0),this.object.setDepth(100)}setText(t){this.object.text=t}}class v{constructor(t){e(this,"scene"),e(this,"heartsManager"),e(this,"scoreText"),e(this,"gameOverScreen"),this.scene=t,this.heartsManager=new y(t),this.scoreText=new b(t,0,0,"Punkty: 0",{fontSize:48}),this.gameOverScreen=new m(t,.5)}}class f extends i.Scene{constructor(){super("Game"),e(this,"camera"),e(this,"background"),e(this,"msg_text"),e(this,"player"),e(this,"tilemapManager"),e(this,"uiContainer"),e(this,"stats")}create(){this.sound.pauseAll();let{width:t,height:e}=this.sys.game.canvas;this.background=this.add.image(t/2,e/2,"sky").setScale(.75),this.background.setScrollFactor(0),this.playThemeMusic(),this.player=new n(this,200,200),this.stats={hearts:3,score:0,isGameOver:!1},this.tilemapManager=new u(this,0,0,3),this.physics.world.setBounds(0,-e,1/0,2*e),this.cameras.main.startFollow(this.player,!0,1,0,-300,0),this.cameras.main.setBounds(0,-e,1/0,2*e),this.tilemapManager.tilemaps.forEach((t=>{t.botLayer&&this.physics.add.collider(this.player,t.botLayer)})),this.uiContainer=new v(this),this.createObjectColliders()}update(t){this.player.update(t),this.tilemapManager.update(),this.checkIfPlayerIsOutsideMap(),console.log("Współrrzędne kamery: ",this.cameras.main.scrollX,this.cameras.main.scrollY)}playThemeMusic(){this.sound.play("gameTheme",{loop:!0})}createObjectColliders(){this.tilemapManager.getAllObjects().forEach((t=>{t instanceof o?this.physics.add.overlap(this.player,t,(()=>{t.collect()&&(this.stats.score+=50,this.uiContainer.scoreText.setText("Punkty: "+this.stats.score))})):t instanceof c&&this.physics.add.overlap(this.player,t,(()=>{this.handlePlayerHurt()}))}))}handlePlayerHurt(){!this.stats.isGameOver&&this.player.hurt()&&(this.stats.hearts--,this.uiContainer.heartsManager.setHearts(this.stats.hearts),this.stats.hearts<=0&&this.gameOver())}checkIfPlayerIsOutsideMap(){this.player.y+this.player.height>this.physics.world.bounds.bottom&&(this.handlePlayerHurt(),this.player.setY(-100))}gameOver(){this.stats.isGameOver=!0,this.player.death(),this.uiContainer.gameOverScreen.turnOn(this.stats.score)}}class S extends i.Scene{constructor(){super("MainMenu"),e(this,"background"),e(this,"logo"),e(this,"title"),e(this,"startButton")}create(){let{width:t,height:e}=this.sys.game.canvas;this.add.image(t/2,e/2-100,"menu-background").setScale(.85),this.logo=this.add.image(t/2,e/2-100,"logo").setScale(.5),this.startButton=new p(this,t/2,e/2+125,"btn-play",(()=>{this.scene.start("Game")})),this.startButton.body.setScale(.65)}}class x extends i.Scene{constructor(){super("Preloader")}init(){let{width:t,height:e}=this.sys.game.canvas;const s=this.add.image(t/2,e/2,"load-bar-bg").setScale(.5),i=s.width*s.scaleX,a=s.height*s.scaleY,r=s.x-i/2,h=this.add.image(r+7,e/2,"load-bar-content").setOrigin(0,.5);this.add.image(t/2,e/2-50,"load-bar-text").setScale(.75);const n=(i-10)/h.width,o=a/h.height*.8;h.setScale(n,o),this.load.on("progress",(t=>{const e=h.width,s=h.height;h.setCrop(0,0,e*t,s)}))}preload(){this.load.setPath("assets/images"),this.load.image("sky","sky.png"),this.load.image("menu-background","ui/menu/bg.png"),this.load.image("logo","ui/menu/logo.png"),this.load.image("gameOver-bg","ui/you_lose/bg.png"),this.load.image("gameOver-header","ui/you_lose/header.png"),this.load.image("gameOver-table","ui/you_lose/table.png"),this.load.image("btn-play","ui/btn/play.png"),this.load.image("btn-menu","ui/btn/menu.png"),this.load.image("btn-restart","ui/btn/restart.png"),this.load.spritesheet("character-run","character-run.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("character-jump","character-jump.png",{frameWidth:128,frameHeight:128}),this.load.spritesheet("spritesheet","spritesheet.png",{frameWidth:21,frameHeight:21,margin:3,spacing:2}),this.loadTilemaps(),this.loadMusic()}createAnimations(){this.anims.create({key:"character-run",frames:this.anims.generateFrameNumbers("character-run",{start:0,end:7}),frameRate:10,repeat:-1}),this.anims.create({key:"character-jump",frames:this.anims.generateFrameNumbers("character-jump",{start:0,end:3}),frameRate:10,repeat:-1})}loadTilemaps(){this.load.setPath("assets/JSON"),this.load.tilemapTiledJSON("tile1","tile1.json"),this.load.tilemapTiledJSON("tile2","tile2.json"),this.load.tilemapTiledJSON("tile3","tile3.json")}loadMusic(){this.load.setPath("assets/sound"),this.load.audio("gameTheme","gameTheme.mp3"),this.load.audio("menuTheme","menuTheme.vaw"),this.load.audio("player-hurt","player-hurt.ogg"),this.load.audio("coin-pickup","coin-pickup.wav"),this.load.audio("player-jump","player-jump.wav")}create(){this.createAnimations(),this.scene.start("MainMenu")}}const w={type:Phaser.AUTO,width:1280,height:720,parent:"game-container",backgroundColor:"#6eced6",powerPreference:"high-performance",fps:{target:60},scene:[a,x,S,f,r],pixelArt:!0,physics:{default:"arcade",arcade:{debug:!1,gravity:{y:1200,x:0},fps:60}},scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH}};document.addEventListener("DOMContentLoaded",(()=>{new i.Game({...w,parent:"game-container"})}));
